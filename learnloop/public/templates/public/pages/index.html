{% extends "public/templates/main.html" %}
{% load static %}

{% block title %}Learn Loop - Página Principal{% endblock %}

{% block content %}
    {% include "public/templates/parts/header.html" %}
    <div class="main-container">

        {% include "public/templates/parts/abaProjetos.html" %}
        <div class="projetos-container">    

        <div class="aba-de-projetos-container">
            <div class="aba-de-projetos">
                <h1 class="titulo-projetos">Seus Projetos</h1>
                <hr class="linha-projetos">
                <div class="projetos-lista">
                    {% for p in projetos_atuais %}
                        <a href="{% url 'public:index' %}?projeto_id={{ p.id }}" class="projeto-link" style="text-decoration: none;">
                            <div class="rectangle-div {% if selected_project and selected_project.id == p.id %}active-project-item{% endif %}">
                                <h4 class="projectName">{{ p.nome }}</h4>
                            </div>
                        </a>
                    {% empty %}
                        <p>Nenhum projeto encontrado.</p>
                    {% endfor %}
                </div>

                {% if is_professor %}
                    <a href="javascript:void(0);" class ="adicionar-projeto" id="showAddProjectModalButton">
                        <img class="plus-icon" src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Projeto">
                        <h4>Adicionar Projeto</h4>
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="projetos-container">

            <div class="projetos">
                <div class="projeto-header">
                    <h1 class="titulo-projeto">{{ project_title }}</h1>
                    <div class="menu-icons">
                        <div class="status-button">
                            <img src="{% static 'public/images/Activity.svg' %}" alt="Status">
                            {% if selected_project %}
                                <h3>{{ selected_project.get_status_display }}</h3>
                            {% else %}
                                <h3>Status</h3>
                            {% endif %}
                        </div>
                        <img src="{% static 'public/images/Sidebar.svg' %}" alt="Ícone do Projeto">
                        <img src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções">
                    </div>
                </div>
                <hr class="linha-projetos">

                <div class="projetos-principal">
                    <div class="tabs-menu" id="tabsMenu">
                        <div class="tab active" data-tab="backlog"><h3>Back-Log</h3></div>
                        <div class="tab" data-tab="sprint-atual"><h3>Sprint Atual</h3></div>
                        <div class="tab" data-tab="roadmap"><h3>Roadmap</h3></div>
                        <div class="tab" data-tab="meus-itens"><h3>Meus Itens</h3></div>
                    </div>
                    <div class="project-content-area">
                        {# Conteúdo da Aba Backlog #}
                        <div id="content-backlog" class="tab-content active-content">
                            <div class="columns-container">
                                <div class="board-column">
                                    <div class="column-header">
                                        <h3>Back-Log</h3>
                                        <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções">
                                    </div>
                                    <div class="tasks-list">
                                        {% if selected_project %}
                                            {% for item in backlog_items %}
                                                <div class="task-card">{{ item.titulo }}</div>
                                            {% empty %}
                                                <div class="no-tasks-message">Nenhum item no Back-Log para este projeto.</div>
                                            {% endfor %}
                                        {% else %}
                                             <div class="no-tasks-message">Selecione um projeto para ver o Back-Log.</div>
                                        {% endif %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <h3>Adicionar Task</h3>
                                    </div>
                                </div>

                            </div>
                        </div>

                        {# Conteúdo da Aba Sprint Atual #}
                        <div id="content-sprint-atual" class="tab-content">
                            <div class="columns-container">

                                <div class="board-column">
                                    <div class="column-header"><h3>ToDo</h3> <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções"></div>
                                    <div class="tasks-list">

                                        {% for task in sprint_tasks %}
                                            <div class="task-card">{{ task.titulo }}</div>
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa ToDo.</div>
                                        {% endfor %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <h3>Adicionar Task</h3>
                                    </div>

                                        {% if selected_project %}
                                            {% for task in sprint_tasks_todo %}
                                                <div class="task-card">{{ task.titulo }}</div>
                                            {% empty %}
                                                <div class="no-tasks-message">Nenhuma tarefa ToDo.</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="no-tasks-message">Selecione um projeto.</div>
                                        {% endif %}
                                    </div>
                                    <div class="add-task-button"><img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa"> <span>Adicionar Task</span></div>

                                </div>
                                <div class="board-column">
                                    <div class="column-header"><h3>In Progress</h3> <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções"></div>
                                    <div class="tasks-list">
                                        {% if selected_project %}
                                            {% for task in sprint_tasks_in_progress %}
                                                <div class="task-card">{{ task.titulo }}</div>

                                            {% endif %}
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa em progresso.</div>
                                        {% endfor %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <h3>Adicionar Task</h3>
                                    </div>

                                            {% empty %}
                                                <div class="no-tasks-message">Nenhuma tarefa em progresso.</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="no-tasks-message">Selecione um projeto.</div>
                                        {% endif %}
                                    </div>
                                    <div class="add-task-button"><img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa"> <span>Adicionar Task</span></div>

                                </div>
                                <div class="board-column">
                                    <div class="column-header"><h3>Complete</h3> <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções"></div>
                                    <div class="tasks-list">
                                        {% if selected_project %}
                                            {% for task in sprint_tasks_complete %}
                                                <div class="task-card">{{ task.titulo }}</div>

                                            {% endif %}
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa completa.</div>
                                        {% endfor %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <h3>Adicionar Task</h3>
                                    </div>

                                            {% empty %}
                                                <div class="no-tasks-message">Nenhuma tarefa completa.</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="no-tasks-message">Selecione um projeto.</div>
                                        {% endif %}
                                    </div>
                                    <div class="add-task-button"><img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa"> <span>Adicionar Task</span></div>

                                </div>
                            </div>
                        </div>


                        <div id="content-sprint-atual" class="tab-content">

                        {# Conteúdo da Aba Roadmap #}
                        <div id="content-roadmap" class="tab-content">

                            <div class="columns-container">
                                <div class="board-column">
                                    <div class="column-header">
                                        <h3>ToDo</h3>
                                        <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções">
                                    </div>
                                    <div class="tasks-list">

                                        {% for task in sprint_tasks %}
                                            <div class="task-card">{{ task.titulo }}</div>
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa ToDo.</div>
                                        {% endfor %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <span>Adicionar Task</span>
                                    </div>
                                </div>
                                <div class="board-column">
                                    <div class="column-header">
                                        <h3>In Progress</h3>
                                        <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções">
                                    </div>
                                    <div class="tasks-list">
                                        {% for task in sprint_tasks %}
                                            {% if task.status == "in_progress" %}
                                                <div class="task-card">{{ task.titulo }}</div>
                                            {% endif %}
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa em progresso.</div>
                                        {% endfor %}

                                        {% if selected_project %}
                                            {% for milestone in roadmap_milestones %}
                                                <div class="task-card">{{ milestone.nome }} - {{ milestone.data_limite|date:"d/m/Y" }}</div>
                                            {% empty %}
                                                <div class="no-tasks-message">Nenhum marco no Roadmap para este projeto.</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="no-tasks-message">Selecione um projeto para ver o Roadmap.</div>
                                        {% endif %}

                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <span>Adicionar Task</span> {# Idealmente seria Adicionar Marco aqui #}
                                    </div>
                                </div>


                            </div>
                        </div>

                        {# Conteúdo da Aba Meus Itens #}
                        <div id="content-meus-itens" class="tab-content">
                            <div class="columns-container">

                                <div class="board-column">
                                    <div class="column-header">
                                        <h3>Complete</h3>
                                        <img class="column-options-icon" src="{% static 'public/images/More horizontal.svg' %}" alt="Mais Opções">
                                    </div>
                                    <div class="tasks-list">

                                        {% for task in sprint_tasks %}
                                            {% if task.status == "complete" %}
                                                <div class="task-card">{{ task.titulo }}</div>
                                            {% endif %}
                                        {% empty %}
                                            <div class="no-tasks-message">Nenhuma tarefa completa.</div>
                                        {% endfor %}
                                    </div>
                                    <div class="add-task-button">
                                        <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Tarefa">
                                        <span>Adicionar Task</span>
                                    </div>

                                        {% if selected_project %}
                                            {% for task in user_tasks_for_project %}
                                                <div class="task-card">{{ task.titulo }}</div> {# Pode-se adicionar mais detalhes da tarefa #}
                                            {% empty %}
                                                <div class="no-tasks-message">Nenhuma tarefa atribuída a você neste projeto.</div>
                                            {% endfor %}
                                        {% else %}
                                            <div class="no-tasks-message">Selecione um projeto para ver suas tarefas.</div>
                                        {% endif %}
                                    </div>
                                    {# Botão de adicionar tarefa pode não ser relevante aqui, ou deve ser contextual #}

                                </div>
                            </div>
                        </div>

                        <div id="content-roadmap" class="tab-content">
                            
                        </div>

                        <div id="content-meus-itens" class="tab-content">
                            
                        </div>

                        <div class="add-col-button">
                            <img src="{% static 'public/images/Plus circle.svg' %}" alt="Adicionar Item">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {# Modal de Adicionar Projeto #}
    <div id="addProjectModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" id="closeAddProjectModalButton">&times;</span>
            <h2>Criar Novo Projeto</h2>
            <label for="projectNameInputModal">Nome do Projeto:</label>
            <input type="text" id="projectNameInputModal" name="projectNameModal" required>
            <button id="confirmCreateProjectButtonModal">Criar Projeto</button>
            <p id="modalErrorMessage" style="color:red; margin-top: 10px;"></p>
        </div>
    </div>
    <script>
    // Passa a URL para o JavaScript (para o modal de criar projeto)
    var createProjectAjaxUrl = "{% url 'public:criar_projeto_ajax' %}";
    // O restante do seu main.js para abas e modal continuará funcionando.
    </script>
{% endblock %}
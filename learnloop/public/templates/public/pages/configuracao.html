{% extends "public/templates/main.html" %}
{% load static %}

{% block title %}Learn Loop - Configurações do projeto{% endblock %}

{% block content %}
<div class="config-header">
    <a href="{% url 'public:index' %}?projeto_id={{ project.id }}" class="back-button">
        <img src="{% static 'public/images/Arrow left.svg' %}" alt="Voltar">
    </a>
    <h1>Configurações</h1>
</div>

<div class="config-container">
    <aside class="config-sidebar">
        <nav id="config-tabs">
            <a href="#" class="nav-link active" data-tab="config-projeto">
                <img src="{% static 'public/images/Settings.svg' %}" alt=""> Configurações do Projeto
            </a>
            <a href="#" class="nav-link" data-tab="acesso-papeis">
                <img src="{% static 'public/images/Users.svg' %}" alt=""> Configurar acesso e papéis
            </a>
            <a href="#" class="nav-link" data-tab="tags-labels">
                <img src="{% static 'public/images/tag.svg' %}" alt=""> Tags/Labels
            </a>
            <a href="#" class="nav-link" data-tab="prioridade">
                <img src="{% static 'public/images/Plus square.svg' %}" alt=""> Prioridade
            </a>
            <a href="#" class="nav-link" data-tab="tamanho">
                <img src="{% static 'public/images/Plus square.svg' %}" alt=""> Tamanho
            </a>
            <a href="#" class="nav-link" data-tab="iteracao-sprint">
                <img src="{% static 'public/images/Pie chart.svg' %}" alt=""> Iteração/Sprint
            </a>
            <a href="#" class="nav-link" data-tab="milestone">
                <img src="{% static 'public/images/milestone.svg' %}" alt=""> Milestone
            </a>
            <a href="#" class="nav-link" data-tab="fluxo-trabalho">
                <img src="{% static 'public/images/Git branch.svg' %}" alt=""> Fluxo de trabalho
            </a>
            <a href="#" class="nav-link" data-tab="arquivados">
                <img src="{% static 'public/images/Archive.svg' %}" alt=""> Arquivados
            </a>
        </nav>
    </aside>

    <div class="config-content">
        <div id="config-projeto" class="tab-pane active">
            <h2 class="config-content-title">Configurações do Projeto</h2>
            <form id="configProjectForm">
                {% csrf_token %}
                <div class="form-group">
                    <label for="projectName">Nome do projeto</label>
                    <input type="text" class="form-control" id="projectName" value="{{ project.nome }}">
                </div>
                <div class="form-group">
                    <label for="projectDescription">Descrição curta</label>
                    <textarea class="form-control" id="projectDescription" rows="3">{{ project.descricao }}</textarea>
                </div>
                <div class="form-group">
                    <label for="readmeEditor">README</label>
                    <textarea id="readmeEditor">{{ project.observacoes }}</textarea>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button type="submit" class="btn btn-primary" id="saveChangesButton">Salvar Alterações</button>
                    <span id="saveStatus" style="color: green; font-weight: bold; display: none;"></span>
                </div>
            </form>
            
            {% if is_professor %}
            <div class="sensitive-options">
                <h3>OPÇÕES SENSÍVEIS</h3>
                <div class="option-item">
                    <div>
                        <strong>Fechar projeto</strong>
                        <p>Fechar este projeto irá desabilitar os workflows e removerá o acesso dos alunos.</p>
                    </div>
                    <button class="btn btn-danger" id="closeProjectBtn">Fechar Projeto</button>
                </div>
                <div class="option-item">
                    <div>
                        <strong>Deletar projeto</strong>
                        <p>Uma vez deletado, o projeto é excluído permanentemente. Por favor tenha certeza de sua escolha.</p>
                    </div>
                    <button class="btn btn-danger" id="deleteProjectBtn">Deletar Projeto</button>
                </div>
            </div>
            {% endif %}
        </div>
        <div id="tags-labels" class="tab-pane">
            <div class="tags-header">
                <h2 class="config-content-title">Tags/Labels</h2>
                <div class="tags-actions">
                    <input type="text" id="label-search-input" class="form-control" placeholder="Procurar labels...">
                    <button id="new-label-btn" class="btn btn-primary">Nova label</button>
                </div>
            </div>
            <div class="labels-list-container">
                <div class="labels-list-header">
                    <span id="label-count">0</span> labels
                </div>
                <ul id="labels-list" class="labels-list">
                    </ul>
            </div>


            <div id="label-modal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3 id="label-modal-title">Nova label</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <form id="label-form" novalidate>
                        <div class="label-preview-container">
                            <span id="label-preview" class="label-tag-preview">Prévia da Label</span>
                        </div>
                        <div class="form-group">
                            <label for="label-name-input">Nome da label</label>
                            <input type="text" id="label-name-input" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="label-description-input">Descrição (opcional)</label>
                            <textarea id="label-description-input" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="label-color-input">Cor</label>
                            <div class="color-input-wrapper">
                                <button type="button" id="color-refresh-btn" title="Gerar cor aleatória">&#x21bb;</button>
                                <input type="text" id="label-color-input" class="form-control" value="#66038f" required>
                            </div>
                        </div>
                        <div class="modal-footer-popup" style="justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                            <button type="submit" id="save-label-btn" class="btn btn-primary">Criar label</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="deleteLabelModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Excluir esta label?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Isto irá remover a label deste projeto. <strong>Esta ação não pode ser desfeita.</strong></p>
                    </div>
                    <div class="modal-footer-popup">
                        <button class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button id="confirm-delete-label-btn" class="btn btn-danger">Excluir label</button>
                    </div>
                </div>
            </div>

            <div id="label-options-menu" class="options-menu">
                <div class="menu-item" id="edit-label-option">Editar</div>
                <div class="menu-item danger" id="delete-label-option">Excluir</div>
            </div>
        </div>
        <div id="acesso-papeis" class="tab-pane">
            <h2 class="config-content-title">Configurar Acesso e Papéis</h2>
            <p>Adicione e gerencie os membros participantes do projeto.</p>
            <div class="invite-collaborators-section">
                <h4>Convidar colaboradores</h4>
                <div class="invite-controls">
                    <div class="search-wrapper">
                        <img src="{% static 'public/images/Search.svg' %}" class="search-icon" alt="Search">
                        <input type="text" id="user-search-input" class="form-control" placeholder="Buscar por nome de usuário ou matrícula">
                        <div id="user-search-results" class="search-results-dropdown"></div>
                    </div>

                    <p id="invite-status-message" class="status-message"></p>
                    
                    <div class="dropdown-wrapper">
                        <button id="invite-filter-btn" class="dropdown-btn">
                            <span id="invite-filter-label">Todos</span>
                            <img src="{% static 'public/images/Chevron down.svg' %}" class="dropdown-arrow" alt="v">
                        </button>
                        <div id="invite-filter-menu" class="dropdown-menu">
                            <a href="#" class="dropdown-item" data-type="all">Todos</a>
                            <a href="#" class="dropdown-item" data-type="aluno">Aluno</a>
                            <a href="#" class="dropdown-item" data-type="professor">Professor</a>
                        </div>
                    </div>

                    <button id="invite-users-btn" class="btn btn-primary">Convidar</button>
                </div>
            </div>

            <div class="manage-access-section">
                <h4>Gerenciar acesso</h4>
                <div class="manage-header">
                    <div class="member-select-all">
                        <input type="checkbox" id="select-all-members-checkbox">
                        <label for="select-all-members-checkbox"><span id="member-count">{{ participantes_atuais|length }}</span> membros</label>
                    </div>
                    <div class="member-filters">
                        <input type="text" id="member-list-search" class="form-control" placeholder="Filtrar membros...">
                        <div class="dropdown-wrapper">
                            <button id="manage-filter-btn" class="dropdown-btn">
                                <span id="manage-filter-label">Todos</span>
                                <img src="{% static 'public/images/Chevron down.svg' %}" class="dropdown-arrow" alt="v">
                            </button>
                            <div id="manage-filter-menu" class="dropdown-menu">
                                <a href="#" class="dropdown-item" data-type="all">Todos</a>
                                <a href="#" class="dropdown-item" data-type="aluno">Aluno</a>
                                <a href="#" class="dropdown-item" data-type="professor">Professor</a>
                            </div>
                        </div>
                    </div>
                    <button id="remove-selected-btn" class="btn btn-danger" style="display: none;">Remover selecionados</button>
                </div>

                <ul id="member-list" class="access-list">
                    {% for membro in participantes_atuais %}
                    <li class="access-list-item" data-user-id="{{ membro.id }}" data-user-type="{{ membro.tipo_usuario }}">
                        <input type="checkbox" class="member-checkbox">
                        <img src="https://i.pravatar.cc/40?u={{ membro.matricula }}" alt="Avatar" class="avatar">
                        <div class="user-info">
                            <span class="user-name">{{ membro.nome_completo }}</span>
                            <span class="user-username">{{ membro.matricula }}</span>
                        </div>
                        <span class="user-role-tag {{ membro.tipo_usuario }}">{{ membro.get_tipo_usuario_display }}</span>
                        <button class="remove-btn">Remover</button>
                    </li>
                    {% empty %}
                    <li class="access-list-item" style="justify-content: center; color: #777;">
                        Nenhum membro neste projeto ainda.
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div id="remove-user-modal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Remover Membro(s)</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Tem certeza que deseja remover o(s) membro(s) selecionado(s) deste projeto?</p>
                    </div>
                    <div class="modal-footer-popup">
                        <button class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button id="confirm-remove-btn" class="btn btn-danger">Remover</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="prioridade" class="tab-pane">
            <h2 class="config-content-title">Prioridade</h2>
            <p>Defina as tags de prioridade que podem ser atribuídas às tarefas do seu projeto. Arraste para reordenar.</p>

            <div class="priority-settings-container">
                <div class="priority-list-header">
                    <span>Opção</span>
                    <span>Descrição</span>
                </div>
                <ul id="priority-list" class="priority-list">
                    {# Os itens existentes serão renderizados aqui pelo Django #}
                    <li class="priority-item" data-id="1" draggable="true">
                        <div class="priority-handle">::</div>
                        <div class="priority-tag-container">
                            <span class="priority-tag p-red" data-color-class="p-red">P0</span>
                        </div>
                        <div class="priority-description">
                            <input type="text" value="Alta prioridade. DEVE ser concluído ao final do Sprint" readonly>
                        </div>
                        <button class="priority-options-btn">...</button>
                    </li>
                    <li class="priority-item" data-id="2" draggable="true">
                        <div class="priority-handle">::</div>
                        <div class="priority-tag-container">
                            <span class="priority-tag p-orange" data-color-class="p-orange">P1</span>
                        </div>
                        <div class="priority-description">
                            <input type="text" value="Média prioridade, tem que estar pronto o quanto antes e trabalhado com atenção" readonly>
                        </div>
                        <button class="priority-options-btn">...</button>
                    </li>
                    <li class="priority-item" data-id="3" draggable="true">
                        <div class="priority-handle">::</div>
                        <div class="priority-tag-container">
                            <span class="priority-tag p-yellow" data-color-class="p-yellow">P2</span>
                        </div>
                        <div class="priority-description">
                            <input type="text" value="Baixa prioridade, deve ser feita em tempo hábil, mas não impacta no progresso geral da sprint ou pode ser postergada" readonly>
                        </div>
                        <button class="priority-options-btn">...</button>
                    </li>
                </ul>

                <div class="add-priority-form">
                    <input type="text" id="newPriorityInput" class="form-control" placeholder="Adicionar nome da prioridade...">
                    <button id="addPriorityBtn" class="btn btn-secondary">Adicionar</button>
                </div>
            </div>

            <div id="priority-options-menu" class="options-menu">
                <div class="menu-item" id="edit-priority-option"><img src="{% static 'public/images/Settings.svg' %}" alt=""> Editar Tag</div>
                <div class="menu-item danger" id="remove-priority-option"><img src="{% static 'public/images/Archive.svg' %}" alt=""> Remover Tag</div>
            </div>

            <div id="editPriorityModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Editar Tag</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <div class="form-group">
                            <label for="editPriorityLabel">Título da Tag</label>
                            <input type="text" id="editPriorityLabel" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Cor</label>
                            <div id="editPriorityColorPicker" class="color-picker">
                                <span class="color-swatch p-gray" data-color-class="p-gray"></span>
                                <span class="color-swatch p-blue" data-color-class="p-blue"></span>
                                <span class="color-swatch p-green" data-color-class="p-green"></span>
                                <span class="color-swatch p-yellow" data-color-class="p-yellow"></span>
                                <span class="color-swatch p-orange" data-color-class="p-orange"></span>
                                <span class="color-swatch p-red" data-color-class="p-red"></span>
                                <span class="color-swatch p-pink" data-color-class="p-pink"></span>
                                <span class="color-swatch p-purple" data-color-class="p-purple"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editPriorityDescription">Descrição</label>
                            <textarea id="editPriorityDescription" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer-popup">
                        <button id="cancelEditBtn" class="btn btn-secondary">Cancelar</button>
                        <button id="saveEditBtn" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </div>

            <div id="deletePriorityModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Excluir Tag?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Isso irá excluir permanentemente esta Tag do campo "Prioridade". <strong>Isso não pode ser desfeito.</strong></p>
                        <div class="warning-box">
                            A Tag será excluída permanentemente de qualquer item neste projeto.
                        </div>
                    </div>
                    <div class="modal-footer-popup">
                        <button id="cancelDeleteBtn" class="btn btn-secondary">Cancelar</button>
                        <button id="confirmDeleteBtn" class="btn btn-danger">Excluir</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="tamanho" class="tab-pane">
            <h2 class="config-content-title">Tamanho</h2>
            <p>Defina os tamanhos que podem ser atribuídos às tarefas para estimar o esforço.</p>

            <div class="size-settings-container">
                <div class="size-list-header">
                    <span>Opção</span>
                    <span>Descrição</span>
                </div>
                <ul id="size-list" class="size-list">
                    {# Itens pré-existentes, como viriam do seu banco de dados #}
                    <li class="size-item" data-id="xs" draggable="true">
                        <div class="size-handle">::</div>
                        <div class="size-tag-container">
                            <span class="size-tag s-green" data-color-class="s-green">XS</span>
                        </div>
                        <div class="size-description">
                            <input type="text" value="Tarefa muito fácil/simples, que provavelmente deve ser terminada em poucas hours ou questão de minutos" readonly>
                        </div>
                        <button class="size-options-btn">...</button>
                    </li>
                    <li class="size-item" data-id="s" draggable="true">
                        <div class="size-handle">::</div>
                        <div class="size-tag-container">
                            <span class="size-tag s-red" data-color-class="s-red">S</span>
                        </div>
                        <div class="size-description">
                            <input type="text" value="Tarefa fácil, envolve determinada análise mas continua sendo de fácil solução" readonly>
                        </div>
                        <button class="size-options-btn">...</button>
                    </li>
                    <li class="size-item" data-id="m" draggable="true">
                        <div class="size-handle">::</div>
                        <div class="size-tag-container">
                            <span class="size-tag s-blue" data-color-class="s-blue">M</span>
                        </div>
                        <div class="size-description">
                            <input type="text" value="Tarefa mediana, pode ser simples porém será extensa ou exigirá mais atenção e horas trabalhadas" readonly>
                        </div>
                        <button class="size-options-btn">...</button>
                    </li>
                    <li class="size-item" data-id="l" draggable="true">
                        <div class="size-handle">::</div>
                        <div class="size-tag-container">
                            <span class="size-tag s-purple" data-color-class="s-purple">L</span>
                        </div>
                        <div class="size-description">
                            <input type="text" value="Tarefa complicada, exigirá atenção, pesquisa e talvez horas a alguns dias de trabalho" readonly>
                        </div>
                        <button class="size-options-btn">...</button>
                    </li>
                    <li class="size-item" data-id="xl" draggable="true">
                        <div class="size-handle">::</div>
                        <div class="size-tag-container">
                            <span class="size-tag s-orange" data-color-class="s-orange">XL</span>
                        </div>
                        <div class="size-description">
                            <input type="text" value="Tarefa Difícil, faça-a com cuidado, pois o nível de dificuldade é alto e imprevistos podem impactar o tempo de produção ou outras tarefas..." readonly>
                        </div>
                        <button class="size-options-btn">...</button>
                    </li>
                </ul>

                <div class="add-size-form">
                    <input type="text" id="newSizeInput" class="form-control" placeholder="Adicionar nome do tamanho...">
                    <button id="addSizeBtn" class="btn btn-secondary">Adicionar</button>
                </div>
            </div>

            <div id="size-options-menu" class="options-menu">
                <div class="menu-item" id="edit-size-option"><img src="{% static 'public/images/Settings.svg' %}" alt=""> Editar Tag</div>
                <div class="menu-item danger" id="remove-size-option"><img src="{% static 'public/images/Archive.svg' %}" alt=""> Remover Tag</div>
            </div>

            <div id="editSizeModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Editar Tag</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <div class="form-group">
                            <label for="editSizeLabel">Título da Tag</label>
                            <input type="text" id="editSizeLabel" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Cor</label>
                            <div id="editSizeColorPicker" class="color-picker">
                                <span class="color-swatch s-gray" data-color-class="s-gray"></span>
                                <span class="color-swatch s-blue" data-color-class="s-blue"></span>
                                <span class="color-swatch s-green" data-color-class="s-green"></span>
                                <span class="color-swatch s-orange" data-color-class="s-orange"></span>
                                <span class="color-swatch s-red" data-color-class="s-red"></span>
                                <span class="color-swatch s-purple" data-color-class="s-purple"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="editSizeDescription">Descrição</label>
                            <textarea id="editSizeDescription" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer-popup">
                        <button id="cancelEditSizeBtn" class="btn btn-secondary">Cancelar</button>
                        <button id="saveEditSizeBtn" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </div>

            <div id="deleteSizeModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Excluir Tag?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Isso irá excluir permanentemente esta Tag do campo "Tamanho". <strong>Isso não pode ser desfeito.</strong></p>
                        <div class="warning-box">
                            A Tag será excluída permanentemente de qualquer item neste projeto.
                        </div>
                    </div>
                    <div class="modal-footer-popup">
                        <button id="cancelDeleteSizeBtn" class="btn btn-secondary">Cancelar</button>
                        <button id="confirmDeleteSizeBtn" class="btn btn-danger">Excluir</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="iteracao-sprint" class="tab-pane">
            <h2 class="config-content-title">Iterações</h2>
            <p>Gerencie os ciclos de trabalho do seu projeto. Clique em "+ Adicionar Iteração" para criar uma com a duração padrão ou use "Mais opções" para personalizar.</p>

            <div class="iteration-settings-container">
                <div class="iteration-header">
                    <div class="iteration-tabs">
                        <button class="iteration-tab-btn active" data-view="current">Atuais & Futuras</button>
                        <button class="iteration-tab-btn" data-view="completed">Completadas</button>
                    </div>
                    <div class="iteration-actions">
                        <button id="add-iteration-btn" class="btn btn-secondary">+ Adicionar Iteração</button>
                        <div class="iteration-options-wrapper">
                            <button id="more-options-btn" class="btn btn-secondary-outline">Mais opções</button>
                            <div id="more-options-popover" class="iteration-duration-popover">
                                <h4>Criar Iteração Personalizada</h4>
                                <div class="form-group">
                                    <label>Começa em</label>
                                    <input type="text" id="custom-start-date-picker" class="form-control" placeholder="Padrão: hoje">
                                </div>
                                <div class="form-group">
                                    <label>Duração (opcional)</label>
                                    <div class="duration-form">
                                        <input type="number" id="custom-duration-input" class="form-control" placeholder="2">
                                        <select id="custom-unit-select" class="form-control">
                                            <option value="weeks">semanas</option>
                                            <option value="days">dias</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="popover-footer">
                                    <button id="cancel-custom-add-btn" class="btn btn-secondary">Cancelar</button>
                                    <button id="confirm-custom-add-btn" class="btn btn-primary">Adicionar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <table class="sprints-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th style="width: 25%;">Datas</th>
                            <th style="width: 15%;">Estado</th>
                            <th style="width: 5%;"></th>
                        </tr>
                    </thead>
                    <tbody id="sprints-table-body"></tbody>
                </table>
                <div id="sprints-loading" style="text-align: center; padding: 20px;">Carregando...</div>
            </div>

            <div id="deleteSprintModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Excluir Iteração?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Tem certeza de que deseja excluir esta iteração? <strong>Essa ação não pode ser desfeita.</strong></p>
                    </div>
                    <div class="modal-footer-popup">
                        <button class="btn btn-secondary cancel-delete-sprint">Cancelar</button>
                        <button id="confirmDeleteSprintBtn" class="btn btn-danger">Excluir</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="milestone" class="tab-pane">
            <h2 class="config-content-title">Milestones</h2>

            <div class="milestone-container">
                <div class="milestone-header">
                    <div class="milestone-filters">
                        <button class="milestone-filter-btn active">Open</button>
                        <button class="milestone-filter-btn">Closed</button>
                    </div>
                    <div class="milestone-actions">
                        <div class="sort-menu-wrapper">
                            <button id="sort-milestone-btn" class="btn btn-secondary-outline">Sort</button>
                            <div id="milestone-sort-menu" class="options-menu">
                                <div class="menu-item">Recently updated</div>
                                <div class="menu-item">Furthest due date</div>
                                <div class="menu-item">Closest due date</div>
                                <div class="menu-item">Least complete</div>
                                <div class="menu-item">Most complete</div>
                            </div>
                        </div>
                        <button id="new-milestone-btn" class="btn btn-primary">New milestone</button>
                    </div>
                </div>

                <ul id="milestone-list" class="milestone-list">
                </ul>
            </div>

            <div id="milestone-options-menu" class="options-menu">
                <div class="menu-item" id="edit-milestone-option">Edit</div>
                <div class="menu-item" id="close-milestone-option">Close</div>
                <div class="menu-item danger" id="delete-milestone-option">Delete</div>
            </div>

            <div id="milestone-modal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3 id="milestone-modal-title">Create milestone</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <form id="milestone-form">
                        <div class="modal-body-popup">
                            <div class="form-group">
                                <label for="milestone-title-input">Title</label>
                                <input type="text" id="milestone-title-input" class="form-control" placeholder="Milestone name">
                            </div>
                            <div class="form-group">
                                <label for="milestone-due-date-input">Due date (optional)</label>
                                <input type="text" id="milestone-due-date-input" class="form-control" placeholder="Choose date...">
                            </div>
                            <div class="form-group">
                                <label for="milestone-description-input">Description</label>
                                <textarea id="milestone-description-input" class="form-control" rows="5" placeholder="Describe your milestone"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer-popup">
                            <button type="button" class="btn btn-secondary close-modal-btn">Cancel</button>
                            <button type="submit" id="save-milestone-btn" class="btn btn-primary">Create milestone</button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="deleteMilestoneModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Excluir Milestone?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Tem certeza de que deseja excluir este milestone? Todas as issues associadas serão desvinculadas. <strong>Essa ação não pode ser desfeita.</strong></p>
                    </div>
                    <div class="modal-footer-popup">
                        <button class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button id="confirm-delete-milestone-btn" class="btn btn-danger">Excluir</button>
                    </div>
                </div>
            </div>

            <div id="closeMilestoneModal" class="modal-overlay">
                <div class="modal-content-popup">
                    <div class="modal-header-popup">
                        <h3>Fechar Milestone?</h3>
                        <button class="close-modal-btn">&times;</button>
                    </div>
                    <div class="modal-body-popup">
                        <p>Isto irá marcar o milestone como concluído. Você ainda poderá vê-lo na aba "Closed".</p>
                    </div>
                    <div class="modal-footer-popup">
                        <button class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button id="confirm-close-milestone-btn" class="btn btn-primary">Fechar Milestone</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="fluxo-trabalho" class="tab-pane">
            <h2 class="config-content-title">Fluxo de trabalho</h2>
            <p>Conteúdo para Fluxo de trabalho...</p>
        </div>
        <div id="arquivados" class="tab-pane">
            <h2 class="config-content-title">Arquivados</h2>
            <p>Conteúdo para Arquivados...</p>
        </div>
    </div>
</div>
<div id="closeProjectModal" class="modal-overlay">
    <div class="modal-content-popup">
        <div class="modal-header-popup">
            <h3>Fechar Projeto?</h3>
            <button class="close-modal-btn">&times;</button>
        </div>
        <div class="modal-body-popup">
            <p>Tem certeza que deseja fechar o projeto "{{ project.nome }}"? Esta ação irá arquivá-lo e o tornará inacessível para os participantes.</p>
        </div>
        <div class="modal-footer-popup">
            <button id="cancelCloseProjectBtn" class="btn btn-secondary">Cancelar</button>
            <button id="confirmCloseProjectBtn" class="btn btn-danger">Sim, Fechar</button>
        </div>
    </div>
</div>

<div id="deleteProjectModal" class="modal-overlay">
    <div class="modal-content-popup">
        <div class="modal-header-popup">
            <h3>DELETAR PROJETO?</h3>
            <button class="close-modal-btn">&times;</button>
        </div>
        <div class="modal-body-popup">
            <p>Você está prestes a deletar o projeto "{{ project.nome }}".</p>
            <div class="warning-box">
                <strong>Atenção:</strong> Esta ação é irreversível e excluirá permanentemente o projeto, suas tarefas e todos os dados associados.
            </div>
        </div>
        <div class="modal-footer-popup">
            <button id="cancelDeleteProjectBtn" class="btn btn-secondary">Cancelar</button>
            <button id="confirmDeleteProjectBtn" class="btn btn-danger">Sim, Deletar Permanentemente</button>
        </div>
    </div>
</div>
<script>
    var saveConfigAjaxUrl = "{% url 'public:salvar_configuracoes_projeto_ajax' project.id %}";
    var closeProjectAjaxUrl = "{% url 'public:fechar_projeto' project.id %}";
    var deleteProjectAjaxUrl = "{% url 'public:deletar_projeto' project.id %}";
    window.PROJECT_ID = "{{ project.id|default:'' }}";
    window.MANAGE_LABELS_URL = "{% url 'public:manage_labels_ajax' project.id %}";
    window.MANAGE_PRIORITIES_URL = "{% url 'public:manage_priorities_ajax' project.id %}";
    window.MANAGE_SIZES_URL = "{% url 'public:manage_sizes_ajax' project.id %}";
</script>

{% endblock %}
